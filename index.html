<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The official website for the Great Falls, SC Police Department. Committed to protecting and serving our community with integrity, respect, and fairness.">
    <meta name="keywords" content="Great Falls Police, GFPD, Great Falls SC, law enforcement, police department">
    
    <title>GFPD | Official Website</title>

    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="assets/favicons/site.webmanifest">
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #111827; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Oswald', sans-serif; }
        .fade-in-up { opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .fade-in-up.is-visible { opacity: 1; transform: translateY(0); }
        .parallax-container {
            position: relative;
            overflow: hidden;
        }
        #parallax-bg {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 110%; /* Extra height to prevent showing edges on scroll */
            background-size: cover;
            background-position: center;
            z-index: 0;
            will-change: transform;
        }
        /* Styles for the AI response section */
        #ai-response h3 { font-size: 1.25rem; font-weight: 700; color: #f59e0b; margin-top: 1.5rem; }
        #ai-response h4 { font-size: 1.1rem; font-weight: 600; color: #ffffff; margin-top: 1rem; }
        #ai-response p { margin-top: 0.5rem; line-height: 1.6; }
        #ai-response ul { list-style-type: disc; margin-left: 1.5rem; margin-top: 0.5rem; }
        #ai-response li { margin-bottom: 0.25rem; }
        #ai-response a { color: #f59e0b; text-decoration: underline; }
        #ai-response a:hover { color: #fbbf24; }
        .source-link { display: inline-block; background-color: #374151; padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.875rem; margin-top: 0.5rem; margin-right: 0.5rem; }
        
        /* Recruiting Flyer Popup Styles */
        #recruiting-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px;
            box-sizing: border-box;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        #recruiting-popup.show {
            opacity: 1;
            visibility: visible;
        }
        
        .popup-content {
            position: relative;
            display: inline-block;
            cursor: default;
            padding: 16px;
            background: linear-gradient(180deg, rgba(17, 24, 39, 0.85) 0%, rgba(17, 24, 39, 0.6) 100%);
            border-radius: 20px;
        }
        
        .popup-content img {
            max-width: calc(100vw - 128px);
            max-height: calc(100vh - 160px);
            width: auto;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.6);
            transition: transform 0.2s ease;
            object-fit: contain;
            cursor: pointer;
            display: block;
        }
        
        .popup-content:hover img {
            transform: scale(1.02);
        }
        
        .popup-close {
            position: absolute;
            top: 0;
            right: 0;
            width: 48px;
            height: 48px;
            background-color: #ef4444;
            color: white;
            border: 2px solid white;
            border-radius: 50%;
            font-size: 24px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 6px 18px rgba(0, 0, 0, 0.45);
            transition: background-color 0.2s ease, transform 0.2s ease;
            z-index: 10000;
        }
        
        .popup-close:hover {
            background-color: #dc2626;
            transform: scale(1.1);
        }
        
        .popup-close:active {
            transform: scale(0.95);
        }
        
        .popup-actions {
            margin-top: 20px;
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .popup-btn {
            min-width: 140px;
            padding: 0.65rem 1.8rem;
            border-radius: 9999px;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.08em;
            font-size: 0.95rem;
            transition: background-color 0.2s ease, color 0.2s ease, transform 0.2s ease;
        }
        
        .popup-btn-primary {
            background-color: transparent;
            border: 2px solid #f97316;
            color: #f97316;
        }
        
        .popup-btn-primary:hover {
            background-color: #f97316;
            color: #111827;
            transform: translateY(-2px);
        }
        
        .popup-btn-secondary {
            background-color: #ef4444;
            border: 2px solid #ef4444;
            color: #ffffff;
        }
        
        .popup-btn-secondary:hover {
            background-color: #dc2626;
            border-color: #dc2626;
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="text-gray-300">

    <!-- Recruiting Flyer Popup Overlay -->
    <div id="recruiting-popup">
        <div class="popup-content">
            <button class="popup-close" aria-label="Close popup">&times;</button>
            <img src="./assets/recruiting-flyer.jpg" alt="Great Falls Police Department Recruitment Flyer" onclick="window.location.href='./recruitment.html'">
            <div class="popup-actions">
                <button class="popup-btn popup-btn-primary" id="popup-more-info">More Info</button>
                <button class="popup-btn popup-btn-secondary" id="popup-close-btn">Close</button>
            </div>
        </div>
    </div>

    <header id="header" class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-3">
            <div class="flex items-center justify-between">
                <a href="./index.html" class="flex items-center space-x-3">
                    <img src="./assets/gfpd-badge.png" alt="Great Falls Police Department Badge" class="h-12 w-auto">
                    <div class="flex flex-col">
                        <span class="text-xl font-bold uppercase tracking-wider text-white">Great Falls</span>
                        <span class="text-sm font-semibold uppercase tracking-widest text-amber-400">Police Department</span>
                    </div>
                </a>
                
                <div class="hidden md:flex items-center space-x-8">
                    <a href="./index.html" class="text-white font-semibold hover:text-amber-400 transition-colors duration-300" aria-current="page">Home</a>
                    <a href="./contact.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Contact</a>
                    <a href="./events.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Events</a>
                    <a href="./recruitment.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Recruitment</a>
                    <a href="./resources.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Resources</a>
                </div>

                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-white focus:outline-none" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                </div>
            </div>

            <div id="mobile-menu" class="hidden md:hidden mt-4">
                <a href="./index.html" class="block py-2 px-4 text-sm text-white bg-gray-700 rounded" aria-current="page">Home</a>
                <a href="./contact.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Contact</a>
                <a href="./events.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Events</a>
                <a href="./recruitment.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Recruitment</a>
                <a href="./resources.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Resources</a>
            </div>
        </nav>
    </header>

    <main>
        <section class="parallax-container relative h-[60vh] min-h-[400px] flex items-center justify-center text-center text-white bg-black">
            <div id="parallax-bg" style="background-image: url('./assets/hero-flags.jpg');"></div>
            <div class="absolute inset-0 bg-black/60 z-10"></div>
            <div class="relative z-20 p-8">
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold uppercase tracking-wider leading-tight drop-shadow-lg">Protecting Today,</h1>
                <h2 class="text-3xl md:text-5xl lg:text-6xl font-semibold uppercase text-amber-400 tracking-wide drop-shadow-lg mt-2">Building for Tomorrow.</h2>
            </div>
        </section>

        <section id="quick-links" class="relative z-20 bg-gray-800 py-16 sm:py-24">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-5 gap-8">
                    <a href="./contact.html?form=report" class="fade-in-up bg-gray-900 p-8 rounded-lg shadow-xl hover:shadow-amber-500/10 hover:-translate-y-2 transition-all duration-300 block">
                        <h3 class="text-xl font-bold text-amber-400 mb-2">File a Report</h3>
                        <p class="text-gray-300">Submit a non-emergency report online quickly and securely.</p>
                    </a>
                    <a href="./contact.html?form=tip" class="fade-in-up bg-gray-900 p-8 rounded-lg shadow-xl hover:shadow-amber-500/10 hover:-translate-y-2 transition-all duration-300 block" style="transition-delay: 100ms;">
                        <h3 class="text-xl font-bold text-amber-400 mb-2">Submit a Tip</h3>
                        <p class="text-gray-300">Share information with us anonymously to help solve crimes.</p>
                    </a>
                    <a href="./events.html" class="fade-in-up bg-gray-900 p-8 rounded-lg shadow-xl hover:shadow-amber-500/10 hover:-translate-y-2 transition-all duration-300 block" style="transition-delay: 200ms;">
                        <h3 class="text-xl font-bold text-amber-400 mb-2">Community Events</h3>
                        <p class="text-gray-300">View our upcoming community meetings and events.</p>
                    </a>
                    <a href="https://www.chesterscsheriff.com/victim-services" target="_blank" rel="noopener noreferrer" class="fade-in-up bg-gray-900 p-8 rounded-lg shadow-xl hover:shadow-amber-500/10 hover:-translate-y-2 transition-all duration-300 block" style="transition-delay: 300ms;">
                        <h3 class="text-xl font-bold text-amber-400 mb-2">Victim Assistance</h3>
                        <p class="text-gray-300">Find resources and support for victims of crime.</p>
                    </a>
                    <a href="./resources.html" class="fade-in-up bg-gray-900 p-8 rounded-lg shadow-xl hover:shadow-amber-500/10 hover:-translate-y-2 transition-all duration-300 block sm:col-span-2 lg:col-span-1 xl:col-auto" style="transition-delay: 400ms;">
                        <h3 class="text-xl font-bold text-amber-400 mb-2">Citizen Resources</h3>
                        <p class="text-gray-300">View helpful links for public safety and information.</p>
                    </a>
                </div>
            </div>
        </section>

        <section id="chief-message" class="pt-16 sm:pt-24 bg-gray-900">
            <div class="container mx-auto px-6">
                <div class="flex flex-col lg:flex-row items-center gap-12">
                    <div class="lg:w-1/3 fade-in-up">
                        <div class="rounded-full shadow-2xl mx-auto w-64 h-64 lg:w-full lg:h-auto lg:aspect-square overflow-hidden border-4 border-gray-700">
                            <img src="./assets/chief-james-parker.png" alt="Chief James Parker" class="w-full h-full object-cover object-top" loading="lazy">
                        </div>
                    </div>
                    <div class="lg:w-2/3 text-center lg:text-left fade-in-up" style="transition-delay: 200ms;">
                        <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider">Meet the Chief</h2>
                        <h3 class="text-xl md:text-2xl font-semibold text-amber-400 mt-1">Chief James Parker</h3>
                        <p class="mt-6 text-lg text-gray-400 leading-relaxed">Chief James Parker was appointed as Chief of Police for the Great Falls Police Department in July, 2025. With over 28 years of law enforcement experience, he has served in roles ranging from patrol officer, Narcotics Commander, Patrol Division Supervisor, and Investigations Division Supervisor. Chief Parker is committed to leading with integrity, accountability, and professionalism while fostering strong relationships between the police department and the community. His vision is to ensure a safe and thriving Great Falls by emphasizing transparency, innovation, and community trust.</p>
                    </div>
                </div>
            </div>
        </section>

        <section id="community-qa" class="py-16 sm:py-24 bg-gray-900">
            <div class="container mx-auto px-6 max-w-4xl text-center">
                <div class="fade-in-up">
                    <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider">Community Q&A</h2>
                    <p class="mt-4 text-lg text-gray-400 max-w-2xl mx-auto">Have a question about local ordinances or safety? Ask our digital assistant for information grounded in official town documents and public safety resources.</p>
                </div>
                <div class="mt-8 fade-in-up">
                    <div class="max-w-2xl mx-auto">
                        <div class="flex flex-col sm:flex-row gap-4">
                            <input type="text" id="ai-prompt" placeholder="Ask about noise ordinances, parking, pets..." class="w-full px-4 py-3 bg-gray-800 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 text-white">
                            <button id="ai-generate-btn" class="bg-amber-500 text-gray-900 font-bold uppercase tracking-wider py-3 px-8 rounded-md hover:bg-amber-400 transition-colors">Ask</button>
                        </div>
                        <div class="mt-4 flex flex-wrap justify-center gap-2">
                            <button class="preset-btn bg-gray-700 text-sm py-1 px-3 rounded-full hover:bg-gray-600">Leash Laws</button>
                            <button class="preset-btn bg-gray-700 text-sm py-1 px-3 rounded-full hover:bg-gray-600">Noise Curfew</button>
                            <button class="preset-btn bg-gray-700 text-sm py-1 px-3 rounded-full hover:bg-gray-600">Marijuana Laws</button>
                            <button class="preset-btn bg-gray-700 text-sm py-1 px-3 rounded-full hover:bg-gray-600">Fireworks rules</button>
                        </div>
                    </div>
                </div>
                <div id="ai-response-container" class="mt-8 text-left bg-gray-800 p-8 rounded-lg border border-gray-700 fade-in-up hidden">
                    <div id="ai-loading" class="text-center hidden">
                        <div class="flex justify-center items-center">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-amber-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
                            <span>Thinking...</span>
                        </div>
                    </div>
                    <div id="ai-response"></div>
                    <div id="ai-sources" class="mt-6 border-t border-gray-600 pt-4"></div>
                    <p class="mt-6 text-xs text-gray-500 italic">Disclaimer: This AI assistant provides information for general guidance only and is not a substitute for legal advice. Please consult official documents or a legal professional for specific situations.</p>
                </div>
            </div>
        </section>
        
        <div class="py-16 sm:py-24 bg-gray-900">
            <div class="container mx-auto px-6 fade-in-up">
                <div class="flex items-center text-gray-600">
                    <div class="flex-grow border-t border-gray-600"></div>
                    <div class="px-4"><img src="./assets/gfpd-coin-back.png" alt="Great Falls Police Officer Badge" class="h-36 w-auto" loading="lazy"></div>
                    <div class="flex-grow border-t border-gray-600"></div>
                </div>
            </div>
        </div>

        <section id="department-principles" class="pb-16 sm:pb-24 bg-gray-900">
            <div class="container mx-auto px-6">
                <div class="grid grid-cols-1 gap-12 text-center max-w-4xl mx-auto">
                    <div class="fade-in-up">
                        <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider">Our Mission</h2>
                        <p class="mt-4 text-lg text-gray-300 leading-relaxed">“The mission of the Great Falls Police Department is to protect life and property, uphold the law, and serve our community with integrity, respect, and fairness. We are committed to building trust through transparency, fostering strong partnerships, and working together with our citizens to create a safe and thriving&nbsp;Great&nbsp;Falls&nbsp;for&nbsp;all.”</p>
                    </div>
                    <div class="fade-in-up">
                        <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider">Our Vision</h2>
                        <p class="mt-4 text-lg text-gray-300 leading-relaxed">“To be recognized as a model of professionalism, innovation, and accountability in law enforcement.”</p>
                    </div>
                </div>
                <div class="mt-12">
                    <div class="text-center mb-12">
                        <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider fade-in-up">Our Core Values</h2>
                        <p class="text-lg text-gray-400 mt-2 fade-in-up">The principles that guide our actions.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8 text-center">
                        <div class="fade-in-up p-6 bg-gray-800 rounded-lg border border-gray-700">
                            <h3 class="text-xl font-bold text-amber-400">Integrity</h3>
                            <p class="mt-2 text-gray-400">We do what is right, even when no one is watching.</p>
                        </div>
                        <div class="fade-in-up p-6 bg-gray-800 rounded-lg border border-gray-700" style="transition-delay: 100ms;">
                            <h3 class="text-xl font-bold text-amber-400">Respect</h3>
                            <p class="mt-2 text-gray-400">We treat all people with dignity, fairness, and compassion.</p>
                        </div>
                        <div class="fade-in-up p-6 bg-gray-800 rounded-lg border border-gray-700" style="transition-delay: 200ms;">
                            <h3 class="text-xl font-bold text-amber-400">Service</h3>
                            <p class="mt-2 text-gray-400">We are dedicated to protecting and serving our community.</p>
                        </div>
                        <div class="fade-in-up p-6 bg-gray-800 rounded-lg border border-gray-700" style="transition-delay: 300ms;">
                            <h3 class="text-xl font-bold text-amber-400">Accountability</h3>
                            <p class="mt-2 text-gray-400">We take responsibility for our actions and decisions.</p>
                        </div>
                        <div class="fade-in-up p-6 bg-gray-800 rounded-lg border border-gray-700" style="transition-delay: 400ms;">
                            <h3 class="text-xl font-bold text-amber-400">Professionalism</h3>
                            <p class="mt-2 text-gray-400">We strive for excellence in every aspect of policing.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-black text-gray-400">
        <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left md:items-start">
                <div>
                    <h3 class="text-lg font-bold text-white uppercase tracking-wider">Contact Us</h3>
                    <address class="mt-4 not-italic">Great Falls Police Department<br>324 Dearborn St<br>Great Falls, SC 29055</address>
                    <div class="mt-4">
                        <p>Non-Emergency: <a href="tel:803-482-2145" class="hover:text-amber-400">(803) 482-2145</a></p>
                        <p>Email: <a href="mailto:contact@GreatFallsPoliceSC.com" class="hover:text-amber-400">contact@GreatFallsPoliceSC.com</a></p>
                        <p class="font-bold text-white">In an Emergency, Dial 911</p>
                    </div>
                </div>
                <div class="flex items-center justify-center">
                    <img src="./assets/gfpd-coin.png" alt="Great Falls Police Department Badge" class="h-40 w-auto" loading="lazy">
                </div>
                <div class="md:text-right">
                     <h3 class="text-lg font-bold text-white uppercase tracking-wider">Site Navigation</h3>
                     <ul class="mt-4 space-y-2">
                         <li><a href="./contact.html" class="hover:text-amber-400">Contact</a></li>
                         <li><a href="./events.html" class="hover:text-amber-400">Events</a></li>
                         <li><a href="./recruitment.html" class="hover:text-amber-400">Recruitment</a></li>
                         <li><a href="./resources.html" class="hover:text-amber-400">Resources</a></li>
                     </ul>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-800 pt-8 text-center text-sm">
                <p>&copy; <span id="current-year"></span> Great Falls Police Department. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        const POPUP_STORAGE_KEY = 'gfpdRecruitingPopupDismissedAt';
        const POPUP_SUPPRESS_DURATION_MS = 60 * 60 * 1000; // 1 hour

        document.addEventListener('DOMContentLoaded', async function() {
            // --- General Page Setup ---
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // --- Recruiting Popup Setup ---
            const recruitingPopup = document.getElementById('recruiting-popup');
            const popupContent = document.querySelector('.popup-content');
            
            const hasRecentDismissal = (() => {
                try {
                    const stored = localStorage.getItem(POPUP_STORAGE_KEY);
                    if (!stored) return false;
                    const dismissedAt = parseInt(stored, 10);
                    if (Number.isNaN(dismissedAt)) return false;
                    return (Date.now() - dismissedAt) < POPUP_SUPPRESS_DURATION_MS;
                } catch (error) {
                    console.warn('Popup dismissal check failed:', error);
                    return false;
                }
            })();

            if (!hasRecentDismissal) {
                setTimeout(() => {
                    if (!window.recruitingPopupDismissed) {
                        recruitingPopup.classList.add('show');
                    }
                }, 500); // Small delay to ensure page is loaded
            } else {
                window.recruitingPopupDismissed = true;
            }
            
            // Close popup when clicking on the backdrop (outside the image)
            recruitingPopup.addEventListener('click', function(e) {
                if (e.target === recruitingPopup) {
                    dismissAndRemember();
                }
            });
            
            // Handle close buttons and CTA
            const closeButton = document.querySelector('.popup-close');
            const closeCtaButton = document.getElementById('popup-close-btn');
            const moreInfoButton = document.getElementById('popup-more-info');
            const rememberDismissal = () => {
                try {
                    localStorage.setItem(POPUP_STORAGE_KEY, Date.now().toString());
                } catch (error) {
                    console.warn('Failed to persist popup dismissal:', error);
                }
            };
            const dismissAndRemember = () => {
                closeRecruitingPopup(true);
                rememberDismissal();
            };

            if (closeButton) {
                closeButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    dismissAndRemember();
                });
            }
            if (closeCtaButton) {
                closeCtaButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    dismissAndRemember();
                });
            }
            if (moreInfoButton) {
                moreInfoButton.addEventListener('click', function() {
                    rememberDismissal();
                    window.location.href = './recruitment.html';
                });
            }
            
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton && mobileMenu) {
                mobileMenuButton.addEventListener('click', () => {
                    const isExpanded = mobileMenuButton.getAttribute('aria-expanded') === 'true';
                    mobileMenuButton.setAttribute('aria-expanded', !isExpanded);
                    mobileMenu.classList.toggle('hidden');
                });
            }

            const animatedElements = document.querySelectorAll('.fade-in-up');
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('is-visible');
                    }
                });
            }, { threshold: 0.1 });
            animatedElements.forEach(el => { observer.observe(el); });

            const parallaxBg = document.getElementById('parallax-bg');
            if (parallaxBg) {
                let ticking = false;
                window.addEventListener('scroll', function() {
                    if (!ticking) {
                        window.requestAnimationFrame(function() {
                            const offset = window.pageYOffset;
                            parallaxBg.style.transform = 'translateY(' + offset * 0.4 + 'px)';
                            ticking = false;
                        });
                        ticking = true;
                    }
                });
            }

            // --- Digital Community Officer ---
            // The rest of the script remains unchanged...
            const apiUrl = "https://gfpd-ai-proxy.mc-bygone.workers.dev";
            const aiPromptInput = document.getElementById('ai-prompt');
            const generateBtn = document.getElementById('ai-generate-btn');
            const presetBtns = document.querySelectorAll('.preset-btn');
            const responseContainer = document.getElementById('ai-response-container');
            const responseEl = document.getElementById('ai-response');
            const sourcesEl = document.getElementById('ai-sources');
            const loadingEl = document.getElementById('ai-loading');
            let ordinanceData = [];
            try {
                const response = await fetch('./assets/ordinances.json');
                if (!response.ok) { throw new Error(`Failed to load ordinances: ${response.statusText}`); }
                ordinanceData = await response.json();
            } catch (error) {
                console.error("Error loading ordinance data:", error);
                responseContainer.classList.remove('hidden');
                responseEl.innerHTML = `<p class="text-red-400">Error: Could not load the town ordinance data. The Q&A feature may not function correctly.</p>`;
            }
            const handleGeneration = async () => {
                const query = aiPromptInput.value.trim();
                if (!query) return;
                if (!apiUrl || apiUrl === "PASTE_YOUR_CLOUDFLARE_WORKER_URL_HERE") {
                    responseContainer.classList.remove('hidden');
                    responseEl.innerHTML = `<p class="text-red-400"><strong>Configuration Error:</strong> The Cloudflare Worker URL has not been set. Please add your URL to the index.html file to enable this feature.</p>`;
                    sourcesEl.innerHTML = "";
                    return;
                }
                responseContainer.classList.remove('hidden');
                loadingEl.classList.remove('hidden');
                responseEl.innerHTML = '';
                sourcesEl.innerHTML = '';
                generateBtn.disabled = true;
                try {
                    const result = await getAIResponse(query);
                    responseEl.innerHTML = marked.parse(result.text);
                    displaySources(result.sources);
                } catch (error) {
                    console.error("Error getting AI response:", error);
                    responseEl.innerHTML = `<p class="text-red-400">Sorry, an error occurred while generating the response. Please try again.</p><p class="text-xs text-gray-500 mt-2">${error.message}</p>`;
                } finally {
                    loadingEl.classList.add('hidden');
                    generateBtn.disabled = false;
                }
            };
            generateBtn.addEventListener('click', handleGeneration);
            aiPromptInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') { handleGeneration(); } });
            presetBtns.forEach(btn => { btn.addEventListener('click', () => { aiPromptInput.value = btn.textContent; handleGeneration(); }); });
            function searchOrdinances(query) {
                if (!ordinanceData || ordinanceData.length === 0) return [];
                const queryWords = query.toLowerCase().split(/\s+/).filter(w => w.length > 2);
                const scoredResults = ordinanceData.map(ordinance => {
                    const title = ordinance.title.toLowerCase();
                    const text = ordinance.text.toLowerCase();
                    let score = 0;
                    queryWords.forEach(word => {
                        if (title.includes(word)) score += 10;
                        if (text.includes(word)) score += 1;
                    });
                    return { ...ordinance, score };
                }).filter(o => o.score > 0);
                scoredResults.sort((a, b) => b.score - a.score);
                return scoredResults.slice(0, 3);
            }
            async function getAIResponse(userQuery) {
                const MIN_SCORE_THRESHOLD = 10;
                let relevantOrdinances = searchOrdinances(userQuery);
                let payload;
                let useWebSearch = false;
                if (relevantOrdinances.length > 0 && relevantOrdinances[0].score >= MIN_SCORE_THRESHOLD) {
                    const context = relevantOrdinances.map(o => `Title: ${o.title}\nContent: ${o.text}`).join('\n\n');
                    const systemPrompt = `You are a helpful, friendly digital assistant for the Great Falls, SC Police Department. Your tone should be professional, clear, and easy to understand for a citizen. Base your answer *strictly* on the provided local ordinances. Do not add information not present in the text. Directly address the user's question. Format your response clearly using markdown.`;
                    payload = { contents: [{ parts: [{ text: `CONTEXT:\n${context}\n\nQUESTION:\n${userQuery}` }] }], systemInstruction: { parts: [{ text: systemPrompt }] }, };
                } else {
                    useWebSearch = true;
                    const systemPrompt = `You are a helpful, friendly digital assistant for the Great Falls, SC Police Department. Your tone should be professional, clear, and easy to understand for a citizen. The user is asking a question about laws or safety. Answer the question specifically for Great Falls, South Carolina, USA. Use the search tool to find the most accurate and up-to-date information. Format your response clearly using markdown.`;
                    payload = { contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] }, tools: [{ "google_search": {} }], };
                }
                let response;
                try {
                    response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) { const errorBody = await response.text(); throw new Error(`API request failed with status ${response.status}: ${errorBody}`); }
                } catch (error) { console.error("Fetch failed:", error); throw new Error("Could not connect to the AI service. Please check your network connection."); }
                const result = await response.json();
                const candidate = result.candidates?.[0];
                if (!candidate || !candidate.content?.parts?.[0]?.text) { console.error("Invalid response structure:", result); throw new Error("Received an invalid response from the AI service."); }
                const text = candidate.content.parts[0].text;
                let sources = [];
                if (useWebSearch) {
                     const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) { sources = groundingMetadata.groundingAttributions.map(attr => ({ uri: attr.web?.uri, title: attr.web?.title })).filter(source => source.uri && source.title); }
                } else { sources = relevantOrdinances.map(o => ({ uri: o.url, title: o.title })); }
                return { text, sources };
            }
            function displaySources(sources) {
                if (!sources || sources.length === 0) { sourcesEl.innerHTML = ""; return; }
                const sourceTitle = sources[0].uri.includes('municode.com') ? 'Source Documents:' : 'Web Sources:';
                const sourceLinks = sources.map(source => `<a href="${source.uri}" target="_blank" rel="noopener noreferrer" class="source-link hover:bg-gray-600">${source.title}</a>`).join('');
                sourcesEl.innerHTML = `<h4 class="text-sm font-bold text-gray-400 uppercase tracking-wider">${sourceTitle}</h4><div class="mt-2">${sourceLinks}</div>`;
            }
        });
        
        // Close recruiting popup function
        function closeRecruitingPopup(markDismissed = false) {
            const recruitingPopup = document.getElementById('recruiting-popup');
            if (markDismissed) {
                window.recruitingPopupDismissed = true;
            }
            recruitingPopup?.classList.remove('show');
        }
    </script>
</body>
</html>