<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Upcoming community events hosted by the Great Falls Police Department. Join us for meetings, charity drives, and community-building activities.">
    <meta name="keywords" content="Great Falls Police Events, Community Calendar, Police Events, GFPD Community">
    <title>Events | Great Falls Police Department</title>
    <link rel="apple-touch-icon" sizes="180x180" href="assets/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/favicons/favicon-16x16.png">
    <link rel="manifest" href="assets/favicons/site.webmanifest">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Roboto', sans-serif; background-color: #111827; }
        h1, h2, h3, h4, h5, h6 { font-family: 'Oswald', sans-serif; }
        .fade-in-up { opacity: 0; transform: translateY(30px); transition: opacity 0.6s ease-out, transform 0.6s ease-out; }
        .fade-in-up.is-visible { opacity: 1; transform: translateY(0); }
        .parallax-container { position: relative; overflow: hidden; }
        #parallax-bg { position: absolute; left: 0; top: 0; width: 100%; height: 110%; background-size: cover; background-position: center; z-index: 0; will-change: transform; }
        .calendar-day { transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; position: relative; }
        .calendar-day:not(.is-disabled):hover { background-color: #374151; cursor: pointer; }
        .calendar-day.is-today { border: 2px solid #6b7280; }
        .calendar-day.is-selected { background-color: #f59e0b; color: #111827; font-weight: bold; }
        .calendar-day.has-event::after { content: ''; position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); width: 6px; height: 6px; border-radius: 50%; background-color: #f59e0b; }
        .calendar-day.is-selected.has-event::after { background-color: #111827; }
        .photo-placeholder { background-color: #1f2937; border: 2px dashed #4b5563; }
        @keyframes flash {
            0%, 50%, 100% { box-shadow: 0 0 0 0 rgba(245, 158, 11, 0.7); }
            25%, 75% { box-shadow: 0 0 0 6px rgba(245, 158, 11, 0); }
        }
        .flash-border { animation: flash 2s ease-out; }
        .flyer-carousel-btn {
            background-color: rgba(31, 41, 55, 0.7);
            border-radius: 9999px;
            padding: 0.5rem;
            transition: background-color 0.2s ease-in-out;
        }
        .flyer-carousel-btn:hover { background-color: rgba(55, 65, 81, 0.9); }
        .flyer-carousel-btn:disabled { opacity: 0.3; cursor: not-allowed; }
        .flyer-item { cursor: pointer; transition: transform 0.2s ease-in-out; }
        .flyer-item:hover { transform: scale(1.03); }
    </style>
</head>
<body class="text-gray-300">
    <header id="header" class="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-50 transition-all duration-300">
        <nav class="container mx-auto px-6 py-3">
            <div class="flex items-center justify-between">
                <a href="./index.html" class="flex items-center space-x-3">
                    <img src="./assets/gfpd-badge.png" alt="Great Falls Police Department Badge" class="h-12 w-auto">
                    <div class="flex flex-col">
                        <span class="text-xl font-bold uppercase tracking-wider text-white">Great Falls</span>
                        <span class="text-sm font-semibold uppercase tracking-widest text-amber-400">Police Department</span>
                    </div>
                </a>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="./index.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Home</a>
                    <a href="./contact.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Contact</a>
                    <a href="./events.html" class="text-white font-semibold hover:text-amber-400 transition-colors duration-300" aria-current="page">Events</a>
                    <a href="./recruitment.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Recruitment</a>
                    <a href="./resources.html" class="text-gray-300 hover:text-amber-400 transition-colors duration-300">Resources</a>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-button" class="text-white focus:outline-none" aria-controls="mobile-menu" aria-expanded="false">
                        <span class="sr-only">Open main menu</span>
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" /></svg>
                    </button>
                </div>
            </div>
            <div id="mobile-menu" class="hidden md:hidden mt-4">
                <a href="./index.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Home</a>
                <a href="./contact.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Contact</a>
                <a href="./events.html" class="block py-2 px-4 text-sm text-white bg-gray-700 rounded" aria-current="page">Events</a>
                <a href="./recruitment.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Recruitment</a>
                <a href="./resources.html" class="block py-2 px-4 text-sm text-gray-300 hover:bg-gray-700 rounded">Resources</a>
            </div>
        </nav>
    </header>
    <main>
        <section class="parallax-container relative py-24 sm:py-32 flex items-center justify-center text-center text-white bg-black">
            <div id="parallax-bg" style="background-image: url('./assets/community-events.jpg');"></div>
            <div class="absolute inset-0 bg-black/70 z-10"></div>
            <div class="relative z-20 p-8 fade-in-up">
                <h1 class="text-4xl md:text-6xl font-bold uppercase tracking-wider drop-shadow-lg">Community & Events</h1>
                <p class="mt-4 text-lg text-gray-300 max-w-3xl mx-auto">Connecting with our community is at the heart of what we do. Find out about upcoming events and see highlights from past gatherings.</p>
            </div>
        </section>
        <section id="calendar-section" class="py-16 sm:py-24 bg-gray-900">
            <div class="container mx-auto px-6 fade-in-up">
                <div class="max-w-6xl mx-auto">
                    <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider text-center">Upcoming Events</h2>
                    <div class="mt-8 flex flex-col md:flex-row gap-8">
                        <div id="event-list-container" class="w-full md:w-1/2 lg:w-2/5">
                            <div class="bg-gray-800 p-6 rounded-lg border border-gray-700">
                                <h3 id="event-list-header" class="text-2xl font-bold text-white uppercase tracking-wider">Upcoming Events</h3>
                                <div id="event-list" class="mt-4 space-y-4">
                                </div>
                                <div id="more-events-link-container" class="mt-4 text-center hidden">
                                    <a href="#calendar-container" id="scroll-to-calendar-link" class="text-amber-400 hover:text-amber-300 font-semibold transition-colors">More Events →</a>
                                </div>
                            </div>
                        </div>
                        <div id="calendar-container" class="w-full md:w-1/2 lg:w-3/5 bg-gray-800 p-6 rounded-lg border border-gray-700">
                            <div class="flex items-center justify-between mb-4">
                                <button id="prev-month-btn" aria-label="Previous month" class="p-2 rounded-full hover:bg-gray-700"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button>
                                <h3 id="month-year-header" class="text-xl font-bold text-white uppercase tracking-wider"></h3>
                                <button id="next-month-btn" aria-label="Next month" class="p-2 rounded-full hover:bg-gray-700"><svg class="w-6 h-6 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></button>
                            </div>
                            <div class="grid grid-cols-7 gap-1 text-center font-semibold text-amber-400 text-sm mb-2">
                                <div>SUN</div><div>MON</div><div>TUE</div><div>WED</div><div>THU</div><div>FRI</div><div>SAT</div>
                            </div>
                            <div id="calendar-grid" class="grid grid-cols-7 gap-1"></div>
                            <div class="mt-4 text-center">
                                <a href="#" id="show-upcoming-link" class="text-amber-400 hover:text-amber-300 font-semibold transition-colors">← View Upcoming</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="flyers" class="py-16 sm:py-24 bg-gray-900">
            <div class="container mx-auto px-6 text-center fade-in-up">
                <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider">Event Flyers</h2>
                <div class="relative mt-12">
                    <div id="flyer-grid" class="flex justify-center">
                        <div class="flyer-item bg-gray-800 rounded-lg overflow-hidden shadow-lg max-w-md">
                            <img src="./assets/blueline-event.jpg" alt="Blue Line BBQ Fundraiser Flyer" class="w-full h-auto">
                        </div>
                    </div>
                    <button id="flyer-prev-btn" aria-label="Previous flyers" class="flyer-carousel-btn absolute top-1/2 left-0 -translate-x-1/2 -translate-y-1/2 z-10 hidden sm:block">
                        <svg class="w-6 h-6 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
                    </button>
                    <button id="flyer-next-btn" aria-label="Next flyers" class="flyer-carousel-btn absolute top-1/2 right-0 translate-x-1/2 -translate-y-1/2 z-10 hidden sm:block">
                        <svg class="w-6 h-6 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
                    </button>
                </div>
            </div>
        </section>

        <section id="gallery" class="py-16 sm:py-24 bg-gray-800">
            <div class="container mx-auto px-6 text-center fade-in-up">
                <h2 class="text-3xl md:text-4xl font-bold text-white uppercase tracking-wider">From Our Past Events</h2>
                <p class="mt-4 text-lg text-gray-400 max-w-2xl mx-auto">Check back here for photos from our community events as they happen!</p>
                <div class="mt-12 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="photo-placeholder aspect-w-3 aspect-h-2 rounded-lg flex items-center justify-center"><span class="text-gray-500 font-semibold">Photo Coming Soon</span></div>
                    <div class="photo-placeholder aspect-w-3 aspect-h-2 rounded-lg flex items-center justify-center"><span class="text-gray-500 font-semibold">Photo Coming Soon</span></div>
                    <div class="photo-placeholder aspect-w-3 aspect-h-2 rounded-lg flex items-center justify-center"><span class="text-gray-500 font-semibold">Photo Coming Soon</span></div>
                </div>
            </div>
        </section>
    </main>
    <footer class="bg-black text-gray-400">
       <div class="container mx-auto px-6 py-12">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left md:items-start">
                <div>
                    <h3 class="text-lg font-bold text-white uppercase tracking-wider">Contact Us</h3>
                    <address class="mt-4 not-italic">Great Falls Police Department<br>324 Dearborn St<br>Great Falls, SC 29055</address>
                    <div class="mt-4">
                        <p>Non-Emergency: <a href="tel:803-482-2145" class="hover:text-amber-400">(803) 482-2145</a></p>
                        <p class="font-bold text-white">In an Emergency, Dial 911</p>
                    </div>
                </div>
                <div class="flex items-center justify-center"><img src="./assets/gfpd-badge.png" alt="Great Falls Police Department Badge" class="h-40 w-auto" loading="lazy"></div>
                <div class="md:text-right">
                     <h3 class="text-lg font-bold text-white uppercase tracking-wider">Site Navigation</h3>
                     <ul class="mt-4 space-y-2">
                         <li><a href="./contact.html" class="hover:text-amber-400">Contact</a></li>
                         <li><a href="./events.html" class="hover:text-amber-400">Events</a></li>
                         <li><a href="./recruitment.html" class="hover:text-amber-400">Recruitment</a></li>
                         <li><a href="./resources.html" class="hover:text-amber-400">Resources</a></li>
                     </ul>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-800 pt-8 text-center text-sm"><p>&copy; <span id="current-year"></span> Great Falls Police Department. All Rights Reserved.</p></div>
        </div>
    </footer>

    <div id="flyer-modal" class="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50 hidden cursor-pointer">
        <img id="modal-image" src="" alt="Event Flyer full size" class="max-w-full max-h-full object-contain cursor-default" style="max-width: 90vw; max-height: 90vh;">
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // General page setup
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            const mobileMenu = document.getElementById('mobile-menu');
            if (mobileMenuButton) { mobileMenuButton.addEventListener('click', () => { mobileMenu.classList.toggle('hidden'); }); }
            const yearSpan = document.getElementById('current-year');
            if (yearSpan) { yearSpan.textContent = new Date().getFullYear(); }
            const animatedElements = document.querySelectorAll('.fade-in-up');
            if (animatedElements.length > 0) {
                const observer = new IntersectionObserver((entries) => { entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('is-visible'); }); }, { threshold: 0.1 });
                animatedElements.forEach(el => observer.observe(el));
            }
            const parallaxBg = document.getElementById('parallax-bg');
            if (parallaxBg) { window.addEventListener('scroll', () => { parallaxBg.style.transform = `translateY(${window.pageYOffset * 0.4}px)`; }); }

            // CALENDAR LOGIC
            const calendarGrid = document.getElementById('calendar-grid');
            const monthYearHeader = document.getElementById('month-year-header');
            const prevMonthBtn = document.getElementById('prev-month-btn');
            const nextMonthBtn = document.getElementById('next-month-btn');
            const eventListContainer = document.getElementById('event-list-container');
            const eventListHeader = document.getElementById('event-list-header');
            const eventList = document.getElementById('event-list');
            const moreEventsLinkContainer = document.getElementById('more-events-link-container');
            const scrollToCalendarLink = document.getElementById('scroll-to-calendar-link');
            const calendarContainer = document.getElementById('calendar-container');
            const showUpcomingLink = document.getElementById('show-upcoming-link');
            let currentDate = new Date();
            let allEvents = [];
            let selectedDateElement = null;

            function correctEventTime(timeString) {
                if (!timeString || !timeString.includes('M')) return timeString;
                const timeParts = timeString.split(' - ');
                const correctedParts = timeParts.map(part => {
                    let [time, modifier] = part.match(/(\d{1,2}:\d{2})(AM|PM)/i).slice(1);
                    let [hours, minutes] = time.split(':').map(Number);
                    if (modifier.toUpperCase() === 'PM' && hours !== 12) hours += 12;
                    if (modifier.toUpperCase() === 'AM' && hours === 12) hours = 0;
                    hours -= 4;
                    if (hours < 0) hours += 24;
                    const newModifier = hours >= 12 ? 'PM' : 'AM';
                    let newHours = hours % 12;
                    if (newHours === 0) newHours = 12;
                    const newMinutes = String(minutes).padStart(2, '0');
                    return `${newHours}:${newMinutes}${newModifier}`;
                });
                return correctedParts.join(' - ');
            }
            
            function formatDescription(description) {
                if (!description) return '';
                const urlRegex = /(https?:\/\/[^\s]+)/g;
                let formattedText = description.replace(urlRegex, (url) => {
                    return `<a href="${url}" target="_blank" rel="noopener noreferrer" class="hover:text-amber-400 underline decoration-dotted">${url}</a>`;
                });
                return formattedText.replace(/\n/g, '<br>');
            }

            async function fetchAndInitialize() {
                eventList.innerHTML = `<div class="text-center pt-10 text-gray-500">Loading events...</div>`;
                try {
                    const response = await fetch('https://gfpd-website.vercel.app/api/getEvents');
                    if (!response.ok) throw new Error('Network response was not ok');
                    const rawEvents = await response.json();
                    // **FIX: Manually parse the date to avoid timezone issues**
                    allEvents = rawEvents.map(event => {
                        const [year, month, day] = event.date.split('-').map(Number);
                        // Create date as local time to prevent the "day-behind" error
                        const dateObj = new Date(year, month - 1, day);
                        return { ...event, dateObj };
                    }).sort((a, b) => a.dateObj - b.dateObj);
                } catch (error) {
                    console.error('Failed to fetch events:', error);
                    eventList.innerHTML = `<p class="text-red-400">Could not load events. Please try again later.</p>`;
                } finally {
                    renderCalendar();
                    displayUpcomingEvents();
                }
            }
            function renderCalendar() {
                calendarGrid.innerHTML = '';
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                monthYearHeader.textContent = currentDate.toLocaleString('default', { month: 'long', year: 'numeric' });
                const firstDayOfMonth = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                const today = new Date();
                for (let i = 0; i < firstDayOfMonth; i++) { calendarGrid.appendChild(document.createElement('div')); }
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayCell = document.createElement('div');
                    dayCell.textContent = day;
                    dayCell.className = 'calendar-day flex items-center justify-center h-12 rounded';
                    dayCell.dataset.date = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const cellDate = new Date(year, month, day);
                    if (allEvents.some(e => e.dateObj.toDateString() === cellDate.toDateString())) { dayCell.classList.add('has-event'); }
                    if (day === today.getDate() && month === today.getMonth() && year === today.getFullYear()) { dayCell.classList.add('is-today'); }
                    calendarGrid.appendChild(dayCell);
                }
            }
            function displayUpcomingEvents() {
                eventListHeader.textContent = 'Upcoming Events';
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                const allUpcoming = allEvents.filter(event => event.dateObj >= today);
                const displayEvents = allUpcoming.slice(0, 2);
                if (displayEvents.length > 0) { eventList.innerHTML = displayEvents.map(event => renderEventHTML(event)).join(''); } else { eventList.innerHTML = `<div class="text-center pt-10 text-gray-500">No upcoming events scheduled.</div>`; }
                if (allUpcoming.length > 2) { moreEventsLinkContainer.classList.remove('hidden'); } else { moreEventsLinkContainer.classList.add('hidden'); }
            }
            function displayEventsForDay(date) {
                const formattedDate = date.toLocaleDateString('default', { month: 'long', day: 'numeric' });
                eventListHeader.textContent = `Events for ${formattedDate}`;
                const eventsOnDay = allEvents.filter(event => event.dateObj.toDateString() === date.toDateString());
                if (eventsOnDay.length > 0) { eventList.innerHTML = eventsOnDay.map(event => renderEventHTML(event)).join(''); } else { eventList.innerHTML = `<div class="text-center pt-10 text-gray-500">No events scheduled for this day.</div>`; }
                return eventsOnDay.length > 0;
            }
            function renderEventHTML(event) {
                const eventDate = event.dateObj.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                const location = event.displayLocation.split(',')[0] + ', Great Falls';
                const correctedTime = correctEventTime(event.time);
                const formattedDescription = formatDescription(event.description);
                return `<div class="bg-gray-700/50 p-4 rounded-lg border-l-4 border-amber-500"><h4 class="font-bold text-white">${event.title}</h4><p class="text-sm font-semibold text-gray-300 mt-1">${eventDate}</p><p class="text-sm text-gray-300 mt-1">${correctedTime} @ <a href="${event.mapLink}" target="_blank" rel="noopener noreferrer" class="hover:text-amber-400 underline decoration-dotted">${location}</a></p><p class="text-sm text-gray-400 mt-2 break-words">${formattedDescription}</p></div>`;
            }
            calendarGrid.addEventListener('click', function(e) {
                const dayCell = e.target.closest('.calendar-day');
                if (!dayCell || dayCell.classList.contains('is-disabled')) return;
                if (selectedDateElement) selectedDateElement.classList.remove('is-selected');
                dayCell.classList.add('is-selected');
                selectedDateElement = dayCell;
                const [year, month, day] = dayCell.dataset.date.split('-').map(Number);
                const cellDate = new Date(year, month - 1, day);
                const hasEvents = displayEventsForDay(cellDate);
                if (hasEvents) {
                    eventListContainer.classList.add('flash-border');
                    setTimeout(() => { eventListContainer.classList.remove('flash-border'); }, 2000);
                    eventListContainer.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            });
            if (prevMonthBtn) { prevMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() - 1); if (selectedDateElement) selectedDateElement.classList.remove('is-selected'); selectedDateElement = null; renderCalendar(); }); }
            if (nextMonthBtn) { nextMonthBtn.addEventListener('click', () => { currentDate.setMonth(currentDate.getMonth() + 1); if (selectedDateElement) selectedDateElement.classList.remove('is-selected'); selectedDateElement = null; renderCalendar(); }); }
            if (scrollToCalendarLink) {
                scrollToCalendarLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (window.innerWidth < 768) { calendarContainer.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
                    calendarContainer.classList.add('flash-border');
                    setTimeout(() => { calendarContainer.classList.remove('flash-border'); }, 2000);
                });
            }
            if (showUpcomingLink) {
                showUpcomingLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    if (selectedDateElement) { selectedDateElement.classList.remove('is-selected'); selectedDateElement = null; }
                    displayUpcomingEvents();
                    eventListContainer.classList.add('flash-border');
                    setTimeout(() => { eventListContainer.classList.remove('flash-border'); }, 2000);
                    if (window.innerWidth < 768) { eventListContainer.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
                });
            }
            fetchAndInitialize();

            // FLYER CAROUSEL LOGIC
            const flyers = Array.from(document.querySelectorAll('.flyer-item'));
            const prevFlyerBtn = document.getElementById('flyer-prev-btn');
            const nextFlyerBtn = document.getElementById('flyer-next-btn');
            if (flyers.length > 0) {
                let currentPage = 0;
                let itemsPerPage = 3;
                const updateItemsPerPage = () => {
                    if (window.innerWidth < 768) itemsPerPage = 1;
                    else if (window.innerWidth < 1024) itemsPerPage = 2;
                    else itemsPerPage = 3;
                };
                const showPage = (page) => {
                    currentPage = page;
                    const totalPages = Math.ceil(flyers.length / itemsPerPage);
                    flyers.forEach(flyer => flyer.style.display = 'none');
                    const start = page * itemsPerPage;
                    const end = start + itemsPerPage;
                    const flyersToShow = flyers.slice(start, end);
                    flyersToShow.forEach(flyer => flyer.style.display = 'block');
                    if (totalPages <= 1) {
                        prevFlyerBtn.style.display = 'none';
                        nextFlyerBtn.style.display = 'none';
                    } else {
                        prevFlyerBtn.style.display = 'block';
                        nextFlyerBtn.style.display = 'block';
                        prevFlyerBtn.disabled = (currentPage === 0);
                        nextFlyerBtn.disabled = (currentPage >= totalPages - 1);
                    }
                };
                prevFlyerBtn.addEventListener('click', () => { if (currentPage > 0) showPage(currentPage - 1); });
                nextFlyerBtn.addEventListener('click', () => {
                    const totalPages = Math.ceil(flyers.length / itemsPerPage);
                    if (currentPage < totalPages - 1) showPage(currentPage + 1);
                });
                window.addEventListener('resize', () => { updateItemsPerPage(); showPage(0); });
                updateItemsPerPage();
                showPage(0);
            }

            // FLYER MODAL LOGIC
            const modal = document.getElementById('flyer-modal');
            const modalImage = document.getElementById('modal-image');
            flyers.forEach(flyer => {
                flyer.addEventListener('click', () => {
                    const imageSrc = flyer.querySelector('img').src;
                    modalImage.src = imageSrc;
                    modal.classList.remove('hidden');
                });
            });
            const closeModal = () => {
                modal.classList.add('hidden');
                modalImage.src = '';
            };
            modal.addEventListener('click', closeModal);
            modalImage.addEventListener('click', (e) => { e.stopPropagation(); });
            window.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        });
    </script>
</body>
</html>